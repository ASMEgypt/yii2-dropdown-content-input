$.widget("execut.dropdownContent",{inputEl:null,items:null,containerEl:null,_create:function(){var a=this;a._initElements();a._initEvents();a._initValue();a._checkDisable();a._initItems();if(a.containerEl.hasClass("expanded")){a.openContainer();window.scroll(a.inputEl.offset().top,0);a.inputEl.focus()}else{a.closeContainer();a._trigger("close")}},_initElements:function(){var a=this,b=a.element;a.wrapperEl=b.find(".dropdown-wrapper");a.hiddenInput=a.wrapperEl.find("input[type=hidden]");a.inputEl=a.wrapperEl.find("input[type=text]");a.containerEl=b.find(".dropdown-content-container");a.items=a.containerEl.find(".item");a.caretEl=a.wrapperEl.find(".controll-wrapper");a.formEl=a.inputEl.parents("form");a.formEls=a.formEl.find(":input:not(.tree-input):not(.kv-search-input):not(:button)");a.clearEl=a.caretEl.find(".clear");a.wrapperEl.css("z-index",0);$('label[for="'+a.hiddenInput.attr("id")+'"]').attr("for",a.inputEl.attr("id"))},_initValue:function(){var a=this,b=a.hiddenInput.val();if(b){a.inputEl.val(a.items.filter('[val="'+b+'"]').attr("text"))}},_initEvents:function(){var b=this;b.caretEl.click(function(){b.toggleContainer()});b.inputEl.focus(function(){if(b.isSkipFocus){b.isSkipFocus=false}else{b.openContainer()}});b.inputEl.keyup(function(c){if(c.keyCode==13){b.items.filter(".selected").click()}else{b.openContainer();b.items.removeClass("selected");b.items.each(function(h,e){var d=$(e),g=d.text().toLowerCase(),f=b.inputEl.val().toLowerCase();if(f.length==0){return false}if(g.match(new RegExp("^"+b._escapeRegExp(f)))){d.addClass("selected");return false}})}});$(document.body).click(function(c){if(!$(c.target).is(b.inputEl)&&!$(c.target).is(b.containerEl)&&!$(c.target).is(b.caretEl)&&!$(c.target).is(b.caretEl.children().first())){b.closeContainer()}});b.clearEl.click(function(){b.clear()});b._initItemsEvents();for(var a=0;a<b.options.depends.length;a++){(function(){var d=b.options.depends[a],c=$("#"+d);c.change(function(){if(c.val()===""){b.clear();b.disable()}else{b.reload(b._replaceElementName(c.attr("name")))}})})()}},clear:function(){var a=this;if(a.hiddenInput.val()!==""){a._setSelectedItemValues($());a.hiddenInput.change()}},_initItems:function(){var a=this;if(a.hiddenInput.val().length){var b=a.items.filter('*[val="'+a.hiddenInput.val()+'"]').addClass("selected");if(!b.length){a.hiddenInput.val("");a.inputEl.val("")}}},_checkDisable:function(){var a=this;if(!a.items.length){a.disable()}else{a.enable()}},reload:function(c){var a=this,b=a.serializeForm();b["Filter[changedAttribute]"]=c;a.disable();$.get(a.options.ajaxUrl,b,function(d){a.containerEl.children().remove();a.containerEl.html(d);a.items=a.containerEl.find(".item");a._initItemsEvents();a._checkDisable();a.inputEl.val("").trigger("change").change();a.hiddenInput.val("").trigger("change").change();if(d!==""){a.enable();a.openContainer()}})},serializeForm:function(){var b=this,c={},d=b.formEls;d.filter(function(){var e=jQuery(this),f=e.attr("name");f=b._replaceElementName(f);c[f]=e.val()});for(var a in c){if(c[a]==""||c[a]===null){delete c[a]}}return c},_replaceElementName:function(b){var a=this;b=b.replace(a.options.formName,"Filter",b);return b},disable:function(){var a=this;a.inputEl.val("");a.hiddenInput.val("").change();a.items.removeClass("selected");a.inputEl.attr("disabled","disabled");a.element.attr("disabled","disabled")},enable:function(){var a=this;a.inputEl.attr("disabled",false);a.element.attr("disabled",false)},_initItemsEvents:function(){var a=this;a.items.click(function(){var b=$(this),c=a.hiddenInput.val();a._setSelectedItemValues(b);a.closeContainer();if(c!==a.hiddenInput.val()){a.hiddenInput.change()}return false})},_setSelectedItemValues:function(b){var d=this,e=b.attr("val"),c=b.attr("text");d.items.removeClass("selected");b.addClass("selected");d.inputEl.val(c);var a=d.hiddenInput.val();if(a!==e){d.hiddenInput.val(e)}},toggleContainer:function(){var a=this;if(a.containerEl.is(":visible")){a.closeContainer()}else{a.openContainer()}},isSkipFocus:false,openContainer:function(){var a=this;a._trigger("open");a.containerEl.show();a.element.addClass("active");if(!a.inputEl.is(":focus")){a.isSkipFocus=true;a.inputEl.focus()}a.wrapperEl.css("z-index",100);a.containerEl.css("z-index",10)},_escapeRegExp:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},closeContainer:function(){var b=this,c=b.items.filter(".selected");b.wrapperEl.css("z-index",0);if(b.containerEl.is(":visible")){b.element.removeClass("active");if(c.length){b._setSelectedItemValues(c)}else{var a=b.inputEl.val()!=="";b.inputEl.val("");b.hiddenInput.val("");if(a){b.hiddenInput.change()}}b.containerEl.hide();b._trigger("close")}}});